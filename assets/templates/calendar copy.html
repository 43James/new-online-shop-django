{% extends "base_sidebar.html" %}
{% load static %}

{% block content %}
<div class="container  mt-4">
  <h3 class="justify-content-center d-flex mb-4">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°/‡∏à‡∏≠‡∏á‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h3>
  <div class="mt-4" id="calendar"></div>
</div>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- FullCalendar -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">

<script>
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'th',
        events: "{% url 'assets:calendar_events' %}",
        eventClick: function(info) {
            let props = info.event.extendedProps;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° HTML ‡∏™‡∏ß‡∏¢ ‡πÜ
            let htmlContent = `
                <div style="text-align:left;">
                    <p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${props.status || '-'}</p>
                    <p><b>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</b> ${props.user || '-'}</p>
                    ${props.asset ? `<p><b>‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå:</b> ${props.asset}</p>` : ""}
                    ${props.note ? `<p><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${props.note}</p>` : ""}
                    ${props.notes ? `<p><b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</b> ${props.notes}</p>` : ""}
                </div>
            `;

            Swal.fire({
                title: info.event.title,
                html: htmlContent,
                icon: 'info',
                confirmButtonText: '‡∏õ‡∏¥‡∏î',
                confirmButtonColor: '#3085d6',
                width: 500,
                customClass: {
                    popup: 'rounded-3 shadow-lg'
                }
            });
        }
    });
    calendar.render();
});
</script>

<!-- FullCalendar CSS + JS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var calendarEl = document.getElementById("calendar");

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: "dayGridMonth",
    locale: "th",   // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    timeZone: "Asia/Bangkok",
    height: "auto",
    headerToolbar: {
      left: "prev,next today",
      center: "title",
      right: "dayGridMonth,timeGridWeek,timeGridDay"
    },
    events: "{% url 'assets:calendar_events' %}", // ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Django JSON API
    eventClick: function(info) {
      alert(
        "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:\n" +
        "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: " + info.event.title + "\n" +
        "‡πÄ‡∏£‡∏¥‡πà‡∏°: " + info.event.start.toLocaleString() + "\n" +
        "‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: " + (info.event.end ? info.event.end.toLocaleString() : "-") + "\n" +
        "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: " + (info.event.extendedProps.status || "-") + "\n" +
        "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: " + (info.event.extendedProps.user || "-")
      );
    }
  });

  calendar.render();
});
</script>
{% endblock %}
