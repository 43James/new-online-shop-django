{% extends "base_sidebar.html" %}
{% load static %}

{% block content %}
<style>
    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (Header Toolbar) */
    .fc-header-toolbar.fc-toolbar {
        background-color: #3f51b5; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
        border-radius: 10px;
        padding: 10px;
        color: white; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ö‡∏ô‡πÅ‡∏ñ‡∏ö */
        border: none;
    }

    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° (Buttons) */
    .fc-button {
        background-color: #f0f4f8 !important; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° (‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô) */
        color: #3f51b5 !important; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
        border: none !important;
        box-shadow: none !important;
        text-transform: capitalize !important; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏£‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà */
    }

    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Active/Today) */
    .fc-button-primary:not(:disabled).fc-button-active,
    .fc-button-primary:not(:disabled):active {
        background-color: #7986cb !important; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡πà‡∏≠‡∏ô‡∏•‡∏á) */
        color: white !important;
    }
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô */
    #calendar {
        border-radius: 15px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≠‡∏ö */
        overflow: hidden; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏î‡∏π‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥ */
    }
    /* ‡∏•‡∏ö‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô */
    .fc-daygrid-day-number {
        text-decoration: none !important;
    }

    /* ‡∏•‡∏ö‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ */
    a {
        text-decoration: none !important;
    }
</style>
<div class="container mt-4">
    <h3 class="justify-content-center d-flex mb-4">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°/‡∏à‡∏≠‡∏á‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h3>
    <div class="mt-4" id="calendar"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var calendarEl = document.getElementById("calendar");

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        locale: "th",
        timeZone: "Asia/Bangkok",
        height: "auto",
        headerToolbar: {
            left: "prev,next today",
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay"
        },
        displayEventTime: false,  // <--- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
        events: "{% url 'assets:calendar_events' %}",
        eventClick: function(info) {
            let props = info.event.extendedProps;
            let imageHtml = '';
            let assetDetailsHtml = '';

            if (props.asset_image) {
                imageHtml = `<img src="${props.asset_image}" style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px;" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå">`;
            } else if (props.asset_images && props.asset_images.length > 0) {
                imageHtml = props.asset_images.map(url => `<img src="${url}" style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px;" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå">`).join('');
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
            if (props.total_assets) {
                assetDetailsHtml += `<p><b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</b> ${props.total_assets} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>`;
            }
            if (props.asset_names) {
                assetDetailsHtml += `<p><b>‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</b> ${props.asset_names}</p>`;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏µ
            let statusHtml = `<p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> <span style="color: ${props.status_color || '#6c757d'};"><b>${props.status || '-'}</b></span></p>`;
            
            let htmlContent = `
                <div style="text-align:left;">
                    ${statusHtml}
                    <p><b>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</b> ${props.user || '-'}</p>
                    ${props.asset ? `<p><b>‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå:</b> ${props.asset}</p>` : ""}
                    ${assetDetailsHtml}
                    ${props.note ? `<p><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${props.note}</p>` : ""}
                    ${props.notes ? `<p><b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</b> ${props.notes}</p>` : ""}
                    <p><b>‡πÄ‡∏£‡∏¥‡πà‡∏°:</b> ${info.event.start ? info.event.start.toLocaleString("th-TH") : "-"}</p>
                    <p><b>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</b> ${info.event.end ? info.event.end.toLocaleString("th-TH") : "-"}</p>
                    ${imageHtml}
                </div>
            `;

            Swal.fire({
                title: info.event.title,
                html: htmlContent,
                icon: 'info',
                confirmButtonText: '‡∏õ‡∏¥‡∏î',
                confirmButtonColor: '#3085d6',
                width: 500,
                customClass: {
                    popup: 'rounded-3 shadow-lg'
                }
            });
        }
    });

    calendar.render();
});
</script>
{% endblock %}

<p><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${props.status || '-'}</p>