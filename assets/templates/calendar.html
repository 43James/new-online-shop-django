{% extends "base_sidebar.html" %}
{% load static %}

{% block content %}
<style>
    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (Header Toolbar) - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    .fc-header-toolbar.fc-toolbar {
        background-color: #3f51b5; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
        border-radius: 10px;
        padding: 10px;
        color: white; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ö‡∏ô‡πÅ‡∏ñ‡∏ö */
        border: none;
        margin-bottom: 10px;
    }

    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° (Buttons) - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    .fc-button {
        background-color: #f0f4f8 !important; 
        color: #3f51b5 !important;
        border: none !important;
        box-shadow: none !important;
        text-transform: capitalize !important;
    }

    /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Active/Today) - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    .fc-button-primary:not(:disabled).fc-button-active,
    .fc-button-primary:not(:disabled):active {
        background-color: #7986cb !important; 
        color: white !important;
    }

    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÇ‡∏Ñ‡πâ‡∏á‡∏°‡∏ô - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    #calendar {
        border-radius: 15px; 
        overflow: hidden; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        padding: 0;
    }
    
    /* ‡∏•‡∏ö‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    .fc-daygrid-day-number {
        text-decoration: none !important;
    }

    /* ‡∏•‡∏ö‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    a {
        text-decoration: none !important;
    }
    
    /* ************************************************** */
    /* *** CSS ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏ô SweetAlert *** */
    /* ************************************************** */
    .swal2-popup img.asset-img-small {
        max-width: 250px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô pop-up */
        max-height: 250px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
        object-fit: contain; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î */
    }
    /* ************************************************** */

    /* MEDIA QUERY ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ - ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    @media (max-width: 768px) {
        /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á title ‡πÉ‡∏ô header toolbar */
        .fc-toolbar-title {
            font-size: 1.1rem;
        }

        /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ç‡∏ß‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö FullCalendar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
        .fc-toolbar.fc-header-toolbar {
            flex-direction: column;
            align-items: center;
        }

        .fc-toolbar-chunk:nth-child(1) { /* prev,next today */
            order: 2; 
            margin-top: 10px;
        }
        
        .fc-toolbar-chunk:nth-child(2) { /* title */
            order: 1; 
            margin-bottom: 10px;
        }

        .fc-toolbar-chunk:nth-child(3) { /* dayGridMonth,timeGridWeek,timeGridDay */
            order: 3; 
            margin-top: 55px;
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á */
        .fc-toolbar-chunk:nth-child(3) .fc-button-group {
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
        }
    }

</style>
<div class="container mt-4 mb-4 px-3 px-md-4">
    <h3 class="justify-content-center d-flex mb-4 text-center">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°/‡∏à‡∏≠‡∏á‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå</h3>
    <div class="mt-4" id="calendar"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var calendarEl = document.getElementById("calendar");

    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        locale: "th",
        timeZone: "Asia/Bangkok",
        height: "auto",
        headerToolbar: {
            left: "prev,next today", 
            center: "title",
            right: "dayGridMonth,timeGridWeek,timeGridDay"
        },
        displayEventTime: false, ¬†// ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤
        events: "{% url 'assets:calendar_events' %}",
        eventClick: function(info) {
            let props = info.event.extendedProps;
            let imageHtml = '';
            let assetDetailsHtml = '';

            // ‡πÉ‡∏ä‡πâ Bootstrap class 'img-fluid' ‡πÅ‡∏•‡∏∞ 'rounded' ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            // **‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á 1: ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î max-width ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å style inline**
            const baseImageStyle = "height: auto; margin-top: 10px; border-radius: 5px;";
            // **‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á 2: ‡πÄ‡∏û‡∏¥‡πà‡∏° class 'asset-img-small' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ CSS ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô**
            const imageClasses = "img-fluid rounded asset-img-small"; 

            if (props.asset_image) {
                imageHtml = `<img src="${props.asset_image}" style="${baseImageStyle}" class="${imageClasses}" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå">`;
            } else if (props.asset_images && props.asset_images.length > 0) {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                imageHtml = props.asset_images.map(url => `<img src="${url}" style="${baseImageStyle}" class="${imageClasses} mb-2" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå">`).join('');
            }
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå
            if (props.total_assets) {
                assetDetailsHtml += `<p class="mb-1"><b>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</b> <span class="text-break">${props.total_assets} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></p>`;
            }
            if (props.asset_names) {
                assetDetailsHtml += `<p class="mb-1"><b>‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</b> <span class="text-break">${props.asset_names}</span></p>`;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏µ
            let statusHtml = `<p class="mb-1"><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> <span style="color: ${props.status_color || '#6c757d'};"><b>${props.status || '-'}</b></span></p>`;
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML Content
            let htmlContent = `
                <div style="text-align:left;">
                    ${statusHtml}
                    <p class="mb-1"><b>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</b> <span class="text-break">${props.user || '-'}</span></p>
                    ${props.asset ? `<p class="mb-1"><b>‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå:</b> <span class="text-break">${props.asset}</span></p>` : ""}
                    ${assetDetailsHtml}
                    ${props.note ? `<p class="mb-1"><b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> <span class="text-break">${props.note}</span></p>` : ""}
                    ${props.notes ? `<p class="mb-1"><b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:</b> <span class="text-break">${props.notes}</span></p>` : ""}
                    <p class="mb-1"><b>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:</b> <span class="text-break">${info.event.start ? info.event.start.toLocaleString("th-TH") : "-"}</span></p>
                    <p class="mb-1"><b>‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</b> <span class="text-break">${info.event.end ? info.event.end.toLocaleString("th-TH") : "-"}</span></p>
                    <div class="mt-3 text-center"> ${imageHtml}
                    </div>
                </div>
            `;

            Swal.fire({
                title: info.event.title,
                html: htmlContent,
                icon: 'info',
                confirmButtonText: '‡∏õ‡∏¥‡∏î',
                confirmButtonColor: '#3085d6',
                // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô 90% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (responsive)
                
                height: '90%', 
                customClass: {
                    popup: 'rounded-3 shadow-lg p-3 m-2' 
                }
            });
        }
    });

    calendar.render();
});
</script>
{% endblock %}