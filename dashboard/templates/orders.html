{% extends "dashboard.html" %}
{% load humanize %}
{% block content %}

<script type="text/javascript">
  setInterval(function () {
    window.location.reload();
  }, 30000);  //3000‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ=30‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
</script>
<style>
  .form-check-input {
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô radio button ‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏° */
  }
  .custom-radio {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 2px solid #ccc; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
      border-radius: 50%; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
      background-color: white; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≤‡∏ß */
      cursor: pointer;
      position: relative;
  }
  .form-check-input:checked + .custom-radio {
      background-color: green; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
      border: 2px solid green; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
  }
  /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö radio button ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò */
  .form-check-input:checked + .custom-radio.reject {
      background-color: red; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
      border: 2px solid red; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
  }
  .form-check-label {
          font-size: 24px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
      }
</style>

  <div class="table-responsive">
    <table class="table table-hover " style="margin-bottom: 20%;">
      <thead class="table table-secondary">
        <tr>
          <th scope="col">n</th>
          <th scope="col">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</th>
          <th scope="col">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</th>
          <th scope="col">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th scope="col">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
          <th scope="col">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</th>
          <th scope="col" class="text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th scope="col" class="text-center">‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
          <th scope="col">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
        </tr>
      </thead>
      {% for order in orders %}
      <tbody>
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          <td scope="row">{{ order.user.get_full_name }}</td>
          <td scope="row">ID {{ order.id }}</td>
          <td scope="row">{{ order.items.count }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
          <td scope="row">{{ order.get_total_price|intcomma }} ‡∏ö‡∏≤‡∏ó</td>
          <td scope="row" style="font-size: 15px; width: 2px;">{{ order.date_created| date:"d M Y H:i" }} ‡∏ô.</td>

          {% if order.status == True %}
          <th scope="row" class="text-success text-center">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</td>
            {% elif order.status == False %}

          <th scope="row" class="text-danger text-center">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</td>
            {% else %}
          <th scope="row" class="text-center"><span class="badge bg-warning">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£..</span></td>
            {% endif %}

          <td scope="col" class="text-center"><!-- Button trigger modal -->
            <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal"
              data-bs-target="#exampleModal{{ order.id }}">
              ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal"
              data-bs-target="#exampleModal2{{ order.id }}">
              ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
            </button>
          </td>

          <!-- Modal -->
          <form action="{% url 'dashboard:approve_orders' order.id %}" method="POST">
            {% csrf_token %}
            <div class="modal fade" id="exampleModal{{ order.id }}" tabindex="-1" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content" style="width: 20rem;">
                  <div class="modal-header">
                    <h5 class="modal-title text-center container" id="exampleModalLabel">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ID {{ order.id }}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>

                  <div class="modal-body">
                    <div class="form-check container justify-content-center d-flex mb-3">
                      <input class="form-check-input" type="radio" name="status" id="flexRadioDefault1" 
                             value="True" checked>
                      <label class="custom-radio" for="flexRadioDefault1"></label>
                      <label class="form-check-label text-success" for="flexRadioDefault1" style="font-size: 20px;">
                          &nbsp;&nbsp;‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                      </label>
                    </div>

                    <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á -->
                    <div class="col form-floating mb-2 mt-3">
                    <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á (‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ 23:00) -->
                      <input type="datetime-local"
                          name="date_receive"
                          class="form-control form-control-sm text-secondary date-receive-input"
                          data-order-id="{{ order.id }}"
                          id="date_receive_{{ order.id }}"
                          readonly
                          style="background-color: #f8f9fa; color: #6c757d; font-size: 0.85rem;">
                      <label for="date_receive_{{ order.id }}">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</label>
                      <!-- <h6 class="text-danger text-center">**‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 16:00 ‡∏ô.**</h6> -->
                    </div>

                  <!-- ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
                  <div class="text-danger small mb-3">
                    <p class="mb-1">** ‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡πÄ‡∏ß‡∏•‡∏≤ 16:00 ‡∏ô.</p>
                  </div>

                    <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ -->
                    <div class="col form-floating mb-3 mt-3">
                    <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ 23:00) -->
                      <input type="datetime-local"
                            name="date_approved"
                            class="form-control form-control-sm text-secondary date-approved-input"
                            data-order-id="{{ order.id }}"
                            id="date_approved_{{ order.id }}"
                            readonly
                            style="background-color: #f8f9fa; color: #6c757d; font-size: 0.85rem;">
                      <label for="dateApprovedInput{{ order.id }}">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</label>
                    </div>

                  <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
                  <div class="col form-floating mb-3 mt-3">
                    <input type="text" name="other" class="form-control" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ">
                    <label for="floatingOther">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                  </div>
                      
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <!-- <button type="submit" class="btn btn-primary" onclick="this.style.display='none'">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button> -->
                    <button class="btn btn-success" type="submit" onclick="this.disabled=true; this.innerHTML='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...'; this.form.submit();">
                      ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <!-- Modal -->
          <form action="{% url 'dashboard:approve_orders' order.id %}" method="POST">
            {% csrf_token %}
            <div class="modal fade" id="exampleModal2{{ order.id }}" tabindex="-1" aria-labelledby="exampleModalLabel2"
              aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content" style="width: 20rem;">
                  <div class="modal-header">
                    <h5 class="modal-title text-center container" id="exampleModalLabel">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ID {{ order.id }}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>

                  <div class="modal-body">
                    <div class="form-check container justify-content-center d-flex">
                        <input class="form-check-input" type="radio" name="status" id="flexRadioDefault2" 
                              value="False" checked>
                        <label class="custom-radio reject" for="flexRadioDefault2"></label>
                        <label class="form-check-label text-danger" for="flexRadioDefault2" style="font-size: 20px;">
                            &nbsp;&nbsp;‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                        </label>
                    </div>

                    <!-- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò -->
                    <div class="col form-floating mb-3 mt-3">
                      <input type="datetime-local"
                            name="date_approved"
                            class="form-control form-control-sm text-secondary date-approved-input"
                            value="{{ now|date:'Y-m-d\\TH:i' }}"
                            id="date_approved_{{ order.id }}"
                            readonly
                            style="background-color: #f8f9fa; color: #6c757d; font-size: 0.85rem;">
                      <label for="dateApprovedInput{{ order.id }}">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</label>
                    </div>

                  <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
                  <div class="col form-floating mb-3 mt-3">
                    <input type="text" name="other" class="form-control" placeholder="‡∏ñ‡πâ‡∏≤‡∏°‡∏µ">
                    <label for="floatingOther">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                  </div>

                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <!-- <button type="submit" class="btn btn-primary" onclick="this.style.display='none'">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button> -->
                    <button class="btn btn-success" type="submit" onclick="this.disabled=true; this.innerHTML='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...'; this.form.submit();">
                      ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <td><a href="{% url 'dashboard:order_detail' order.id %}" class="text-decoration-none">
            <button type="button" class="btn btn-sm btn-secondary">
              ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
            </button></a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="9" class="text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</td>
        </tr>
      </tbody>
      {% endfor %}
    </table>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
      // üìå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á: ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‡πÄ‡∏ß‡∏•‡∏≤ 23:00
      const dateReceiveInputs = document.querySelectorAll('.date-receive-input');
  
      dateReceiveInputs.forEach(function(input) {
          const date = new Date();
          const day = date.getDay(); // 0 = Sunday, ..., 6 = Saturday
          const daysUntilMonday = (day === 0) ? 1 : (8 - day);
          date.setDate(date.getDate() + daysUntilMonday);
          date.setHours(23, 0, 0, 0);
          const formattedDate = date.toISOString().slice(0, 16);
          input.value = formattedDate;
      });
  
      // üìå ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Local Time)
      const dateApprovedInputs = document.querySelectorAll('.date-approved-input');

      dateApprovedInputs.forEach(function(input) {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');

          const formattedNow = `${year}-${month}-${day}T${hours}:${minutes}`;
          input.value = formattedNow;
      });
  });
</script>
{% endblock %}
 